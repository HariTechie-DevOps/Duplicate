<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Send OTP</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f5f5f5;
}

.container {
  width: 360px;
  margin: 40px auto;
  background: #fff;
  padding: 25px;
  border-radius: 6px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

h2 {
  text-align: center;
  margin-bottom: 20px;
}

label {
  display: block;
  margin-top: 12px;
  font-weight: 600;
}

.input-group {
  display: flex;
}

select, input {
  width: 100%;
  padding: 8px;
  margin-top: 6px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

select {
  width: 35%;
  margin-right: 6px;
}

input.invalid {
  border-color: red;
}

.error {
  color: red;
  font-size: 12px;
  margin-top: 4px;
  display: none;
}

.actions {
  margin-top: 20px;
  display: flex;
  justify-content: flex-end;
}

button {
  padding: 8px 16px;
  background: #007bff;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
}

button:disabled {
  background: #aaa;
  cursor: not-allowed;
}

/* OTP section hidden initially */
#otpSection {
  display: none;
}
</style>
</head>

<body>

<div class="container">
  <h2>Send OTP</h2>

  <!-- Mobile Number -->
  <label>Mobile</label>
  <div class="input-group">
    <select id="code">
      <option value="+91">+91</option>
      <option value="+1">+1</option>
      <option value="+44">+44</option>
    </select>
    <input id="mobile" maxlength="10" placeholder="Enter mobile number">
  </div>
  <div class="error" id="mobileError"></div>

  <!-- Send OTP Button -->
  <div class="actions">
    <button id="sendOtpBtn" onclick="sendOtp()">Send OTP</button>
  </div>

  <!-- OTP + Proceed -->
  <div id="otpSection">
    <label>Enter OTP</label>
    <input id="otp" maxlength="6" placeholder="6-digit OTP">
    <div class="error" id="otpError"></div>

    <div class="actions">
      <button onclick="proceed()">Proceed</button>
    </div>
  </div>
</div>

<script>
  
const API_BASE = "http://3.110.85.123:8080";

/* Numbers only */
document.getElementById("mobile").addEventListener("input", e => {
  e.target.value = e.target.value.replace(/\D/g, "");
});

document.getElementById("otp").addEventListener("input", e => {
  e.target.value = e.target.value.replace(/\D/g, "");
});

/* SEND OTP */
function sendOtp() {
  const mobileInput = document.getElementById("mobile");
  const mobileError = document.getElementById("mobileError");

  mobileError.style.display = "none";
  mobileInput.classList.remove("invalid");

  if (!mobileInput.value || mobileInput.value.length !== 10) {
    mobileError.textContent = "Enter valid 10-digit mobile number";
    mobileError.style.display = "block";
    mobileInput.classList.add("invalid");
    return;
  }

  document.getElementById("otpSection").style.display = "block";
  document.getElementById("sendOtpBtn").disabled = true;

  const mobile =
    document.getElementById("code").value + mobileInput.value;

  // API Call (backend optional for UI testing)
  fetch(`${API_BASE}/api/password/send-otp`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ mobile })
  })
  .then(data => {
    if (data.success) {
        // Updated message for Developer Mode
        alert("Developer Mode: Check your AWS Terminal for the OTP!"); 
        document.getElementById('otpSection').style.display = 'block';
    } else {
        alert("Error: " + data.message);
    }
});
  
}
function verifyOtp() {
    const mobile = document.getElementById('mobileNumber').value;
    const otp = document.getElementById('otpInput').value;

    fetch(`${API_BASE}/api/password/verify-otp?mobile=${mobile}&otp=${otp}`, {
        method: "POST"
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            alert("Verified! Redirecting to reset password...");
            // This is the next page we need to create
            window.location.href = "reset.html?mobile=" + mobile; 
        } else {
            alert("Invalid OTP. Check the terminal again!");
        }
    });
}
function proceed() {
    const otpInput = document.getElementById("otp");
    const mobile = document.getElementById("code").value + document.getElementById("mobile").value;

    fetch(`${API_BASE}/api/password/verify-otp`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ mobile: mobile, otp: otpInput.value }) // Send BOTH mobile and otp
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            alert("Verified! Going to reset page.");
            window.location.href = "reset.html?mobile=" + mobile; // Pass mobile to next page
        } else {
            alert(data.message);
        }
    });
}
</script>

</body>
</html>

