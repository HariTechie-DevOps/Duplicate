<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sign Up</title>
<style>
    /* Integrated clean styling */
    body { font-family: Arial; display: flex; justify-content: center; background: #f0f2f5; padding-top: 50px; }
    .container { width: 360px; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h2 { text-align: center; color: #333; margin-bottom: 20px; }
    label { display: block; margin-top: 12px; font-weight: 600; color: #555; }
    input, select { width: 100%; padding: 10px; margin-top: 6px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
    .input-group { display: flex; }
    #code { width: 35%; margin-right: 6px; }
    button { width: 100%; padding: 12px; margin-top: 20px; background: #1877f2; color: white; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; }
    button:hover { background: #166fe5; }
    .error { color: red; font-size: 11px; display: none; margin-top: 4px; }
    .signin { text-align: center; margin-top: 15px; font-size: 14px; }
    .signin a { color: #1877f2; font-weight: 600; text-decoration: none; }
</style>
</head>
<body>

<div class="container">
    <h2>Register</h2>

    <label>Full Name</label>
    <input id="name" placeholder="Enter name">
    <div id="nameErr" class="error">Enter at least 3 characters</div>

    <label>Age</label>
    <input id="age" type="number" placeholder="Enter age">
    <div id="ageErr" class="error">Age must be 18-100</div>

    <label>Gender</label>
    <select id="gender">
        <option value="">Select Gender</option>
        <option>Male</option>
        <option>Female</option>
    </select>
    <div id="genderErr" class="error">Please select gender</div>

    <label>Mobile Number</label>
    <div class="input-group">
        <select id="code"><option value="+91">+91</option></select>
        <input id="mobile" placeholder="10 digits">
    </div>
    <div id="mobileErr" class="error">Invalid mobile number</div>

    <label>Password</label>
    <input id="pass" type="password" placeholder="Minimum 6 characters">
    <div id="passErr" class="error">Minimum 6 characters required</div>

    <button onclick="handleSignup()">Sign Up</button>

    <div class="signin">
        Already have an account?
        <a href="signin.html">Sign In</a>
    </div>
</div>



<script>
    const API_BASE = "http://localhost:8080/api";

    // This prevents letters in the mobile field
    document.getElementById('mobile').oninput = e => e.target.value = e.target.value.replace(/\D/g, "");

    function handleSignup() {
        // Reset error messages
        document.querySelectorAll('.error').forEach(e => e.style.display = 'none');
        
        // Collect data into an object matching your Spring Boot User Entity
        const user = {
            name: document.getElementById('name').value.trim(),
            age: document.getElementById('age').value,
            gender: document.getElementById('gender').value,
            mobile: document.getElementById('code').value + document.getElementById('mobile').value,
            password: document.getElementById('pass').value
        };

        let isValid = true;

        // Validation Logic (Real-world example: same as creating a Gmail or bank account)
        if (user.name.length < 3) { 
            document.getElementById('nameErr').style.display = 'block'; 
            isValid = false; 
        }
        if (user.age < 18 || user.age > 100) { 
            document.getElementById('ageErr').style.display = 'block'; 
            isValid = false; 
        }
        if (!user.gender) { 
            document.getElementById('genderErr').style.display = 'block'; 
            isValid = false; 
        }
        // Validates 10 digit mobile (after prefix)
        if (!/^\+91\d{10}$/.test(user.mobile)) { 
            document.getElementById('mobileErr').style.display = 'block'; 
            isValid = false; 
        }
        if (user.password.length < 6) { 
            document.getElementById('passErr').style.display = 'block'; 
            isValid = false; 
        }

        if (!isValid) return;

        // API call to Spring Boot
        fetch(`${API_BASE}/signup`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(user)
        })
        .then(res => {
            if (res.ok) {
                alert("Registration Successful!");
                window.location.href = 'signin.html';
            } else {
                // If Nth user tries to use an existing mobile number, DB returns 400/409
                alert("This mobile number is already registered!");
            }
        })
        .catch(err => {
            console.error("Connection Error:", err);
            alert("Could not connect to the server.");
        });
    }
</script>
</body>
</html>
